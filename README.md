# Laravel Data Object

[![Latest Version on Packagist][ico-version]][link-packagist]
[![Software License][ico-license]](LICENSE.md)
[![Build Status](https://travis-ci.org/czim/laravel-dataobject.svg?branch=master)](https://travis-ci.org/czim/laravel-dataobject)
[![Latest Stable Version](http://img.shields.io/packagist/v/czim/laravel-dataobject.svg)](https://packagist.org/packages/czim/laravel-dataobject)

Basic framework for making standardized but flexible data objects.
This provides a class (and interfaces) to use to standardize your dependencies or return values with a generic dataobject.

All this really is, is a data storage class with magic getters and setters.
It is Arrayable, Jsonable and validatable.

Also provided are the means to make nested validation possible for data objects (containing futher data objects).


## To Do

- Add means to add nested validation (trait, service provider + validation class)
- Add way to vendor:publish some standard validation messages for nested validation


## Install

Via Composer

``` bash
$ composer require czim/laravel-dataobject
```

## Usage

Simply create your own extension of the base dataobject, and: 


### Optionally add your own getters and setters

Basic stuff of course, but if you want your IDE to know what your objects contain, you can simply write getters and setters like this:

```php
class TestDataObject extends \Czim\DataObject\AbstractDataObject
{
    public function getName($value)
    {
        $this->getAttribute('name');
    }
    
    public function setName($value)
    {
        $this->setAttribute('name', $value);
    }
}
```

Additionally, if you want to block any type of magic assignment (meaning all assignment would have to be done through the `setAttribute()` or `setAttributes()` methods, or your own setters), you can disable magic assignment as follows:
 
```php
class TestDataObject extends \Czim\DataObject\AbstractDataObject
{
    protected $magicAssignment = false;
    
    ...
```


### Optionally add validation rules for attributes 

```php
class YourDataObject extends \Czim\DataObject\AbstractDataObject
{
    protected $rules = [
        'name' => 'required|string',
        'list' => 'array|min:1',
    ];
}
```

Validating the data can be done as follows:

```php
    $dataObject = new YourDataObject();
    
    // validate() returns a boolean, false if it does not follow the rules
    if ( ! $dataObject->validate()) {
        
        $messages = $dataObject->messages();
        
        // messages() returns a standard Laravel ErrorBag
        dd( $messages->first() );
    }
```

Messages are a `MessageBag` object generated by the Validator (whatever is behind the Laravel Facade `Validator`).


## Validation

To use the extra Validation features for nested DataObject validation rules and better array validation, load the ServiceProvider for this package.
This is the only reason to load the ServiceProvider; this package does not itself require the Provider to function.

Add this line of code to the providers array located in your `config/app.php` file:

```php
    Czim\DataObject\DataObjectServiceProvider::class,
```

Note that this will rebind the `Validator` facade, so if you have done this yourself, you may instead want to use the provided validation Traits to add to your own extended validator class.
They are:


### Validate Nested DataObjects

`Czim\DataObject\Validation\Traits\ValidateAsDataObjectTrait`

Allows the use of the `dataobject` validation rule to have nested data object validation.

Example:
```php
// ... in \YourNameSpace\FirstDataObject
protected $rules = [
    'some_key' => 'dataobject:\YourNameSpace\SecondDataObject', 
];

// ... in \YourNameSpace\SecondDataObject
protected $rules = [
    'present' => 'required|string',
];


// Now if you validate as follows, it will fail

$data = new \YourNameSpace\FirstDataObject([
    'some_key' => [
        'present' => 123,
    ],
]);

// The messages() would then have two messages
//
// 1. for 'some_key.present': 'The present must be a string.'
// 2. for 'some_key':         'validation.dataobject'
//    (for which you can configure translations as normal)

// Note that it would also fail if the value for 'some_key'
// is a not an array or Arrayable:

// returns false
(new \YourNameSpace\FirstDataObject([
    'some_key' => 'some string',
]))->validate();

// returns true
(new \YourNameSpace\FirstDataObject([
    'some_key' => [ 'present' => 'proper string' ],
]))->validate();


// Though it would allow the value to already be a data object

```

### Validate arrays

`Czim\DataObject\Validation\Traits\ValidateArraysTrait`

Allows the use of the `each` validation rule for more detailed array validation.
 

Example:
```php
// ... in \YourNameSpace\FirstDataObject
protected $rules = [
    'some_list' => 'array|min:1|each:string|each:max,10', 
];

// this would only pass validation if some_list
// - would be an array,
// - would contain at least 1 entry,
// - and each entry in it would be a string of 10 characters at most
```

Mainly added because it is so commonly useful, and this allows for easier installation in some cases.
Plus I do not see how it could hurt.


## Contributing

Please see [CONTRIBUTING](CONTRIBUTING.md) for details.


## Credits

- [Coen Zimmerman][link-author]
- [All Contributors][link-contributors]

## License

The MIT License (MIT). Please see [License File](LICENSE.md) for more information.

[ico-version]: https://img.shields.io/packagist/v/czim/laravel-dataobject.svg?style=flat-square
[ico-license]: https://img.shields.io/badge/license-MIT-brightgreen.svg?style=flat-square
[ico-downloads]: https://img.shields.io/packagist/dt/czim/laravel-dataobject.svg?style=flat-square

[link-packagist]: https://packagist.org/packages/czim/laravel-dataobject
[link-downloads]: https://packagist.org/packages/czim/laravel-dataobject
[link-author]: https://github.com/czim
[link-contributors]: ../../contributors
